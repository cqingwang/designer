<link rel="import" href="../wired-lib/wired-lib.html">

<dom-module id="wired-checkbox">
  <template>
    <style>
       :host {
        display: block;
        font-family: inherit;
      }

       :host(.disabled) {
        opacity: 0.6 !important;
        cursor: default;
        pointer-events: none;
      }

       :host(.disabled) svg {
        background: rgba(0, 0, 0, 0.07);
      }

      #container {
        display: inline-block;
        white-space: nowrap;
      }

      .inline {
        display: inline-block;
        vertical-align: middle;
      }

      #checkPanel {
        cursor: pointer;
      }

      svg {
        display: block;
      }

      path {
        stroke: var(--wired-checkbox-icon-color, currentColor);
        stroke-width: 0.7;
      }
    </style>
    <div id="container" on-click="_toggleCheck">
      <div id="checkPanel" class="inline">
        <svg id="svg" width="0" height="0"></svg>
      </div>
      <div class="inline">{{text}}</div>
    </div>
  </template>

  <script>
    class WiredCheckbox extends Polymer.Element {
      static get is() { return 'wired-checkbox'; }
      static get properties() {
        return {
          checked: {
            type: Boolean,
            value: false,
            notify: true,
            observer: '_onCheckedChange'
          },
          text: String,
          disabled: {
            type: Boolean,
            value: false,
            observer: '_onDisableChange'
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
        this._connected = true;
        this.style.opacity = 0;
        Polymer.RenderStatus.beforeNextRender(this, () => {
          setTimeout(() => {
            this._relayout();
            this.style.opacity = 1;
          }, 100);
        });
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        this._connected = false;
      }

      _clearNode(node) {
        while (node.hasChildNodes()) {
          node.removeChild(node.lastChild);
        }
      }

      _relayout() {
        if (!this._connected) {
          return;
        }
        this._clearNode(this.$.svg);
        var s = { width: 24, height: 24 };
        this.$.svg.setAttribute("width", s.width);
        this.$.svg.setAttribute("height", s.height);
        _WIRES_.rectangle(this.$.svg, 0, 0, s.width, s.height);
        this._checkpaths = [];
        this._checkpaths.push(_WIRES_.line(this.$.svg, s.width * 0.3, s.height * 0.4, s.width * 0.5, s.height * 0.7));
        this._checkpaths.push(_WIRES_.line(this.$.svg, s.width * 0.5, s.height * 0.7, s.width + 5, -5));
        this._checkpaths.forEach((d) => {
          d.style.strokeWidth = 2.5;
        });
        this._updateCheckVisibility();
      }

      _onCheckedChange() {
        if (this._checkpaths && this._checkpaths.length) {
          this._updateCheckVisibility();
        } else {
          this._relayout();
        }
      }

      _updateCheckVisibility() {
        if (this.checked) {
          this._checkpaths.forEach((d) => {
            d.style.display = "";
          });
        } else {
          this._checkpaths.forEach((d) => {
            d.style.display = "none";
          });
        }
      }

      _toggleCheck() {
        this.set("checked", !(this.checked || false));
        const event = new CustomEvent('change', { bubbles: true, composed: true, checked: this.checked, detail: { checked: this.checked } });
        this.dispatchEvent(event);
      }

      _onDisableChange() {
        if (this.disabled) {
          this.classList.add("disabled");
        } else {
          this.classList.remove("disabled");
        }
      }
    }
    window.customElements.define(WiredCheckbox.is, WiredCheckbox);
  </script>
</dom-module>